org: knative-sandbox
repo: eventing-kafka-broker
branches: [main]
image: gcr.io/knative-tests/test-infra/prow-tests:v20220505-456af677
imagePullPolicy: Always

jobs:
  - name: build-tests
    types: [presubmit]
    command: [runner.sh, ./test/presubmit-tests.sh, --build-tests]
    excluded_requirements: [gcp]

  - name: unit-tests
    types: [presubmit]
    command: [runner.sh, ./test/presubmit-tests.sh, --unit-tests]
    excluded_requirements: [gcp]

  - name: integration-tests
    types: [presubmit]
    command: [runner.sh, ./test/presubmit-tests.sh, --integration-tests]
    requirements: [docker]

  - name: upgrade-tests
    types: [presubmit]
    command: [runner.sh, ./test/presubmit-tests.sh, --run-test, "./test/upgrade-tests.sh"]
    requirements: [docker]

  - name: reconciler-tests
    types: [presubmit]
    command: [runner.sh, ./test/presubmit-tests.sh, --run-test, "./test/reconciler-tests.sh"]
    requirements: [docker]

  - name: channel-integration-tests-ssl
    types: [presubmit]
    command: [runner.sh, ./test/presubmit-tests.sh, --run-test, "./test/e2e-tests.sh"]
    requirements: [docker]
    env:
      - name: EVENTING_KAFKA_BROKER_CHANNEL_AUTH_SCENARIO
        value: SSL

  - name: channel-integration-tests-sasl-ssl
    types: [presubmit]
    command: [runner.sh, ./test/presubmit-tests.sh, --run-test, "./test/e2e-tests.sh"]
    requirements: [docker]
    env:
      - name: EVENTING_KAFKA_BROKER_CHANNEL_AUTH_SCENARIO
        value: SASL_SSL

  - name: channel-integration-tests-sasl-plain
    types: [presubmit]
    command: [runner.sh, ./test/presubmit-tests.sh, --run-test, "./test/e2e-tests.sh"]
    requirements: [docker]
    env:
      - name: EVENTING_KAFKA_BROKER_CHANNEL_AUTH_SCENARIO
        value: SASL_PLAIN

  - name: channel-reconciler-tests-ssl
    types: [presubmit]
    command: [runner.sh, ./test/presubmit-tests.sh, --run-test, "./test/reconciler-tests.sh"]
    requirements: [docker]
    env:
      - name: EVENTING_KAFKA_BROKER_CHANNEL_AUTH_SCENARIO
        value: SSL

  - name: channel-reconciler-tests-sasl-ssl
    types: [presubmit]
    command: [runner.sh, ./test/presubmit-tests.sh, --run-test, "./test/reconciler-tests.sh"]
    requirements: [docker]
    env:
      - name: EVENTING_KAFKA_BROKER_CHANNEL_AUTH_SCENARIO
        value: SASL_SSL

  - name: channel-reconciler-tests-sasl-plain
    types: [presubmit]
    command: [runner.sh, ./test/presubmit-tests.sh, --run-test, "./test/reconciler-tests.sh"]
    requirements: [docker]
    env:
      - name: EVENTING_KAFKA_BROKER_CHANNEL_AUTH_SCENARIO
        value: SASL_PLAIN

  - name: continuous
    types: [periodic]
    command: [runner.sh, ./test/presubmit-tests.sh, --all-tests]
    requirements: [docker]

  - name: nightly
    types: [periodic]
    command: [runner.sh, ./hack/release.sh, --publish, --tag-release]
    requirements: [nightly, docker]
    excluded_requirements: [gcp]
    reporter_config:
      slack:
        channel: eventing-kafka
        report_template: |
          "The nightly release job fails, check the log: <{{.Status.URL}}|View logs>"
        job_states_to_report:
        - "failure"

  - name: release
    types: [periodic]
    command: [runner.sh, ./hack/release.sh, --auto-release, --release-gcs, knative-releases/eventing-kafka-broker, --release-gcr, gcr.io/knative-releases, --github-token, /etc/hub-token/token]
    requirements: [release, docker]
    excluded_requirements: [gcp]
